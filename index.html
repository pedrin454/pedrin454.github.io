import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Meu App Responsivo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: HomeScreen(),
    );
  }
}

class HomeScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Meu App Responsivo'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            ElevatedButton(
              onPressed: () => Navigator.push(
                context,
                MaterialPageRoute(builder: (context) => CalculadoraScreen()),
              ),
              child: Text('Calculadora'),
            ),
            SizedBox(height: 20),
            ElevatedButton(
              onPressed: () => Navigator.push(
                context,
                MaterialPageRoute(builder: (context) => JogoDaVelhaScreen()),
              ),
              child: Text('Jogo da Velha'),
            ),
          ],
        ),
      ),
    );
  }
}

class CalculadoraScreen extends StatefulWidget {
  @override
  _CalculadoraScreenState createState() => _CalculadoraScreenState();
}

class _CalculadoraScreenState extends State<CalculadoraScreen> {
  String input = '';

  void _onButtonPressed(String value) {
    setState(() {
      if (value == '=') {
        try {
          input = _evaluateExpression(input);
        } catch (e) {
          input = 'Erro';
        }
      } else if (value == 'C') {
        input = '';
      } else {
        input += value;
      }
    });
  }

  String _evaluateExpression(String expression) {
    try {
      // Substitui operadores e resolve expressão básica
      final result = _calculate(expression);
      return result.toString();
    } catch (e) {
      return 'Erro';
    }
  }

  double _calculate(String expression) {
    // Avalia apenas somas, subtrações, multiplicações e divisões
    List<String> tokens = expression.split(RegExp(r'(\D)'));
    List<String> operators = RegExp(r'(\D)').allMatches(expression).map((m) => m.group(0)!).toList();

    double result = double.parse(tokens[0]);
    for (int i = 0; i < operators.length; i++) {
      double nextValue = double.parse(tokens[i + 1]);
      switch (operators[i]) {
        case '+':
          result += nextValue;
          break;
        case '-':
          result -= nextValue;
          break;
        case '*':
          result *= nextValue;
          break;
        case '/':
          result /= nextValue;
          break;
        default:
          throw FormatException("Operador inválido");
      }
    }
    return result;
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Calculadora'),
      ),
      body: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Padding(
            padding: const EdgeInsets.all(16.0),
            child: Container(
              alignment: Alignment.centerRight,
              child: Text(
                input,
                style: TextStyle(fontSize: 32, fontWeight: FontWeight.bold),
              ),
            ),
          ),
          Expanded(
            child: GridView.count(
              crossAxisCount: 4,
              padding: EdgeInsets.all(16),
              mainAxisSpacing: 8,
              crossAxisSpacing: 8,
              children: [
                '7', '8', '9', '/',
                '4', '5', '6', '*',
                '1', '2', '3', '-',
                'C', '0', '=', '+'
              ].map((btn) => ElevatedButton(
                onPressed: () => _onButtonPressed(btn),
                child: Text(
                  btn,
                  style: TextStyle(fontSize: 24),
                ),
              )).toList(),
            ),
          )
        ],
      ),
    );
  }
}

// Jogo da Velha permanece inalterado
class JogoDaVelhaScreen extends StatefulWidget {
  @override
  _JogoDaVelhaScreenState createState() => _JogoDaVelhaScreenState();
}

class _JogoDaVelhaScreenState extends State<JogoDaVelhaScreen> {
  List<String> board = List.filled(9, '');
  bool isXNext = true;

  void _onTilePressed(int index) {
    if (board[index].isNotEmpty || _calculateWinner() != null) return;
    setState(() {
      board[index] = isXNext ? 'X' : 'O';
      isXNext = !isXNext;
    });
  }

  String? _calculateWinner() {
    const winningLines = [
      [0, 1, 2],
      [3, 4, 5],
      [6, 7, 8],
      [0, 3, 6],
      [1, 4, 7],
      [2, 5, 8],
      [0, 4, 8],
      [2, 4, 6],
    ];

    for (var line in winningLines) {
      final a = line[0];
      final b = line[1];
      final c = line[2];

      if (board[a].isNotEmpty &&
          board[a] == board[b] &&
          board[a] == board[c]) {
        return board[a];
      }
    }
    return null;
  }

  @override
  Widget build(BuildContext context) {
    final winner = _calculateWinner();

    return Scaffold(
      appBar: AppBar(
        title: Text('Jogo da Velha'),
      ),
      body: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Text(
            winner != null
                ? 'Vencedor: $winner'
                : 'Próximo jogador: ${isXNext ? 'X' : 'O'}',
            style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
          ),
          SizedBox(height: 16),
          GridView.builder(
            shrinkWrap: true,
            gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
              crossAxisCount: 3,
              mainAxisSpacing: 8,
              crossAxisSpacing: 8,
            ),
            itemCount: 9,
            itemBuilder: (context, index) => GestureDetector(
              onTap: () => _onTilePressed(index),
              child: Container(
                decoration: BoxDecoration(
                  color: Colors.blue[100],
                  borderRadius: BorderRadius.circular(8),
                ),
                child: Center(
                  child: Text(
                    board[index],
                    style: TextStyle(fontSize: 32, fontWeight: FontWeight.bold),
                  ),
                ),
              ),
            ),
          ),
          ElevatedButton(
            onPressed: () => setState(() {
              board = List.filled(9, '');
              isXNext = true;
            }),
            child: Text('Reiniciar'),
          ),
        ],
      ),
    );
  }
}